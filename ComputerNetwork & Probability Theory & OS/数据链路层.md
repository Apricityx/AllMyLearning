# 数据链路层(data link layer)

## TDMA（Time Division Multiple Access，时分多址）

主要是在Time Division（时分），会将一个频率信道(frequency channel)划分为若干个固定长度的时间片(time slot)，不同的用户在不同的时间片内轮流占用该信道

静态 TDMA：每个用户分配固定时隙(time slot)。

动态 TDMA：根据负载(load)动态调整时隙数量，提高信道利用率。

### CSMA（Carrier Sense Multiple Access，载波侦听多路访问）

适用于总线型拓扑结构，现在已被淘汰

先听后发（Listen Before Talk）

如果信道空闲(idle) → 开始发送；

如果信道忙碌(busy) → 等待一段时间后重新尝试。

## CRC校验码（Cyclic Redundancy Check，循环冗余校验码）



## ARP 协议（Address Resolution Protocol，地址解析协议）

包格式(packet format)：

| 字段          | 说明                                        |
| ------------- | ------------------------------------------- |
| 硬件类型      | 一般为 1（以太网(Ethernet)）                |
| 协议类型      | 一般为 0x0800（IPv4）                       |
| 硬件地址长度  | 一般为 6（MAC地址长度(MAC address length)） |
| 协议地址长度  | 一般为 4（IPv4地址长度）                    |
| 操作码        | 1表示请求(request)，2表示应答(reply)        |
| 发送方MAC地址 | 请求者的 MAC 地址                           |
| 发送方IP地址  | 请求者的 IP 地址                            |
| 目标MAC地址   | 请求目标的 MAC 地址（请求时为0）            |
| 目标IP地址    | 请求目标的 IP 地址                          |

🔁 三、ARP 工作原理（四步流程）
场景：主机 A（192.168.1.10）要向主机 B（192.168.1.20）发送数据，但不知道 B 的 MAC 地址
1️⃣ ARP 请求广播(broadcast)

    主机 A 在局域网(LAN, Local Area Network)中广播一个 ARP 请求：

    "谁是 192.168.1.20？请告诉我你的 MAC 地址。"

    ARP 请求包的目的 MAC 地址是 FF:FF:FF:FF:FF:FF（广播）

2️⃣ 所有主机接收

    网络中所有主机都收到这个广播，但只有 IP 地址为 192.168.1.20 的主机 会响应该请求。

3️⃣ ARP 应答单播(unicast)

    主机 B 发回一个 ARP 应答：

    "我就是 192.168.1.20，我的 MAC 地址是 XX:XX:XX:XX:XX:XX。"

    ARP 应答是 单播 给主机 A 的。

todo： ARP攻击(ARP spoofing)实验

## LAN（Local Area Network，局域网）与 VLAN（Virtual LAN，虚拟局域网）：概念、目的、优势

| 项目     | LAN                                         | VLAN                                                                               |
| -------- | ------------------------------------------- | ---------------------------------------------------------------------------------- |
| 划分方式 | 物理（以太网布线）                          | 逻辑（按配置分组）                                                                 |
| 广播域   | 默认整个 LAN 是一个广播域(broadcast domain) | 每个 VLAN 是一个独立广播域                                                         |
| 隔离性   | 低，所有设备默认可通信                      | 高，需三层设备(layer 3 device)或 ACL（访问控制列表，Access Control List） 才能通信 |
| 灵活性   | 依赖物理位置                                | 可以跨越物理位置自由划分                                                           |
| 安全性   | 低（除非加 ACL/防火墙）                     | 高（不同 VLAN 默认不通）                                                           |
| 配置方式 | 即插即用                                    | 需要在交换机(switch)上配置 VLAN 及端口模式(port mode)                              |

## MPLS（Multi-Protocol Label Switching，多协议标签交换）：用于高速转发

MPLS是一种数据传输机制，通过在数据包(packet)前添加标签(label)来实现快速转发。

MPLS通过IP路由表(IP routing table)来维护一个标签转发表(label forwarding table)

用标签转发不需要查询路由表，极大提高了效率

## 生成树协议 (STP, Spanning Tree Protocol)

生成树协议（STP）是一个二层网络协议，由 IEEE 定义为 IEEE 802.1D 标准，用于在以太网交换网络中消除环路，防止广播风暴、MAC地址表不稳定、数据包重复转发等问题。

## 交换机

交换机是数据链路层的设备，主要功能是根据 MAC 地址转发数据帧。

| 端口类型          | 描述               | 特点              | 应用场景                  |
| ------------- | ---------------- | --------------- | --------------------- |
| **Access 端口** | 接入端口，仅属于一个 VLAN  | 不处理标签（出口剥标签）    | 连接 PC、打印机等终端设备        |
| **Trunk 端口**  | 干道端口，属于多个 VLAN   | 帧打标签（支持 802.1Q） | 交换机之间、交换机到路由器         |
| **Hybrid 端口** | 混合端口，既可打标签也可不打标签 | 更灵活             | 连接无线 AP、IP电话、VLAN混合场景 |

Access端口

Trunk端口
